[package]
name = "masstree"
version = "0.1.0"
edition = "2024"
rust-version = "1.92.0"
authors = ["consistent-milk12"]
description = "Masstree: A high-performance concurrent trie of B+trees for key-value storage"
license = "MIT OR Apache-2.0"
repository = ""
keywords = ["data-structures", "concurrent", "trie", "btree", "key-value"]
categories = ["data-structures", "concurrency", "database-implementations"]
readme = "README.md"
include = ["src/**/*", "Cargo.toml", "LICENSE-*", "README.md"]

[dependencies]
crossbeam-epoch = "0.9.18"
indexmap = "2.12.1"
parking_lot = "0.12.5"

[dev-dependencies]
criterion = "0.8.1"
rand = "0.9.2"
rayon = "1.11.0"

[lints.rust]
# Safety and correctness
unsafe_op_in_unsafe_fn = "warn"
missing_docs = "deny"  # Enforce documentation for public API
missing_debug_implementations = "warn"
rust_2024_compatibility = { level = "warn", priority = -1 }

# Future-proofing
future_incompatible = { level = "warn", priority = -1 }
nonstandard_style = { level = "warn", priority = -1 }

# Unused code detection
unused = { level = "warn", priority = -1 }

[lints.clippy]
# Clippy lint groups
all = { level = "warn", priority = -1 }
pedantic = { level = "warn", priority = -1 }
nursery = { level = "warn", priority = -1 }
cargo = { level = "warn", priority = -1 }

# Performance-critical code policy:
# - These are WARN not DENY to allow targeted #[allow(...)] with justification
# - Each allowed instance must have a SAFETY or INVARIANT comment
# - Prefer debug_assert! + direct access over .get().unwrap() chains
unwrap_used = "warn"
expect_used = "warn"
panic = "warn"
indexing_slicing = "warn"

# Allow in hot paths with justification (use #[allow] locally):
# - missing_panics_doc: Internal functions may panic on invariant violation
# - missing_errors_doc: Not using Result for internal errors

# Pedantic lints - keep most, allow noisy ones
module_name_repetitions = "allow"
missing_errors_doc = "allow"
missing_panics_doc = "allow"

# These SHOULD be enforced for quality
# must_use_candidate = "warn"  # Default from pedantic
# doc_markdown = "warn"        # Default from pedantic

[profile.dev]
opt-level = 0
debug = true
debug-assertions = true
overflow-checks = true
incremental = true

[profile.release]
opt-level = 3
debug = false
debug-assertions = false
overflow-checks = false
lto = "thin"
panic = "abort"
codegen-units = 1
strip = "symbols"

[profile.release-with-debug]
inherits = "release"
debug = true
strip = "none"

[profile.bench]
inherits = "release"
debug = true
strip = "none"

# Uncomment when benchmarks are implemented
# [[bench]]
# name = "benchmarks"
# harness = false
